class e{config={apiUrl:"https://api.passwordless.dev/",apiKey:"",Origin:location.origin,RPID:location.hostname,useHints:"cookie"};constructor(e){this.config={...this.config,...e}}async register(e){let t,i,a;n();try{var{data:s,sessionId:o}=await this.registerBegin(e);t=s,i=o}catch(e){throw console.error("Failed during register/begin"),e}t.challenge=r(t.challenge),t.user.id=r(t.user.id),t.excludeCredentials=t.excludeCredentials.map(e=>(e.id=r(e.id),e)),null===t.authenticatorSelection.authenticatorAttachment&&(t.authenticatorSelection.authenticatorAttachment=void 0);try{a=await navigator.credentials.create({publicKey:t})}catch(e){throw console.warn("Failed during credentials.create in browser. One reason could be because the username is already registered with your authenticator. Please change username or authenticator.",e),e}try{await this.registerComplete(a,i),this.setHint("hint-passwordless")}catch(e){console.warn("Failed during register/complete",e)}}async registerBegin(e){const t=await fetch(this.config.apiUrl+"register/begin",{method:"POST",body:JSON.stringify({token:e,...this._params()}),headers:{Accept:"application/json","Content-Type":"application/json",ApiKey:this.config.apiKey}});return await t.json()}async registerComplete(e,t){let i=new Uint8Array(e.response.attestationObject),n=new Uint8Array(e.response.clientDataJSON),r=new Uint8Array(e.rawId);const s={id:e.id,rawId:a(r),type:e.type,extensions:e.getClientExtensionResults(),response:{AttestationObject:a(i),clientDataJson:a(n)}},o=await fetch(this.config.apiUrl+"register/complete",{method:"POST",body:JSON.stringify({response:s,sessionId:t,sessionId:t,...this._params()}),headers:{Accept:"application/json","Content-Type":"application/json",ApiKey:this.config.apiKey}});return 200===o.status&&this.setHint("hint-passwordless"),await o.json()}async signin(e){var t,i;n();try{({data:t,sessionId:i}=await this.signinBegin(e))}catch(e){throw console.warn("Failed during signin/begin",e),e}let a;t.challenge=r(t.challenge),t.allowCredentials.forEach((function(e){e.id=r(e.id)}));try{a=await navigator.credentials.get({publicKey:t})}catch(e){throw console.warn("Failed during credentials.get in browser.",e),e}try{return(await this.signinComplete(a,i)).data}catch(e){throw console.warn("Failed during signin/complete",e),e}}async signinBegin(e){var t=await fetch(this.config.apiUrl+"signin/begin",{method:"POST",body:JSON.stringify({username:e,...this._params()}),headers:{Accept:"application/json",ApiKey:this.config.apiKey}});return await t.json()}async signinComplete(e,t){let i=new Uint8Array(e.response.authenticatorData),n=new Uint8Array(e.response.clientDataJSON),r=new Uint8Array(e.rawId),s=new Uint8Array(e.response.signature);const o={id:e.id,rawId:a(r),type:e.type,extensions:e.getClientExtensionResults(),response:{authenticatorData:a(i),clientDataJson:a(n),signature:a(s)}};var c=await fetch(this.config.apiUrl+"signin/complete",{method:"POST",body:JSON.stringify({response:o,sessionId:t,...this._params()}),headers:{Accept:"application/json",ApiKey:this.config.apiKey}});return 200===c.status&&this.setHint("hint-passwordless"),await c.json()}_params(){return{RPID:this.config.RPID,Origin:this.config.Origin}}setHint(e){"cookie"===this.config.useHints&&s(e,"1",365)}hasPasswordlessHint(){if("cookie"===this.config.useHints)return"1"===o("hint-passwordless")}}async function t(){return!!i()&&await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}function i(){return void 0!==window.PublicKeyCredential&&"function"==typeof window.PublicKeyCredential}function n(){if(!i())throw new Error("WebAuthn and PublicKeyCredentials are not supported on this browser/device")}const r=function(e){if("string"==typeof e){e=e.replace(/-/g,"+").replace(/_/g,"/");for(var t=window.atob(e),i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);e=i}if(Array.isArray(e)&&(e=new Uint8Array(e)),e instanceof Uint8Array&&(e=e.buffer),!(e instanceof ArrayBuffer))throw new TypeError("could not coerce to ArrayBuffer");return e},a=function(e){if(Array.isArray(e)&&(e=Uint8Array.from(e)),e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array){for(var t="",i=e.byteLength,n=0;n<i;n++)t+=String.fromCharCode(e[n]);e=window.btoa(t)}if("string"!=typeof e)throw new Error("could not coerce to string");return e=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=*$/g,"")},s=(e,t,i=7,n="/")=>{const r=new Date(Date.now()+864e5*i).toUTCString();document.cookie=e+"="+encodeURIComponent(t)+"; expires="+r+"; path="+n},o=e=>document.cookie.split("; ").reduce((t,i)=>{const n=i.split("=");return n[0]===e?decodeURIComponent(n[1]):t},"");export{e as Client,i as isBrowserSupported,t as isPlatformSupported};
//# sourceMappingURL=passwordlessclient.min.mjs.map
