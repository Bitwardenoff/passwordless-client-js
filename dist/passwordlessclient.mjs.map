{"version":3,"file":"passwordlessclient.mjs","sources":["../src/main.js"],"sourcesContent":["ï»¿/**\r\n * A client for the https://passwordless.dev API that allows webdevelopers to add WebAuthn with minimal coding.\r\n *\r\n * @export\r\n * @class PasswordlessClient\r\n */\r\nclass PasswordlessClient {\r\n  config = {\r\n    apiUrl: \"https://api.passwordless.dev/\",\r\n    apiKey: \"\",\r\n    Origin: location.origin,\r\n    RPID: location.hostname,\r\n    useHints: \"cookie\",\r\n  };\r\n  constructor(config) {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Register a new credential to a user\r\n   *\r\n   * @param {*} token Token generated by your backend and the passwordless api.\r\n   * @memberof PasswordlessClient\r\n   */\r\n  async register(token) {\r\n    checkSupport();\r\n    let options;\r\n    let session;\r\n\r\n    try {\r\n      var { data, sessionId } = await this.registerBegin(token);\r\n      options = data;\r\n      session = sessionId;\r\n    } catch (e) {\r\n      console.error(\"Failed during register/begin\");\r\n      throw e;\r\n    }\r\n\r\n    // Turn the challenge back into the accepted format of padded base64\r\n    options.challenge = coerceToArrayBuffer(options.challenge);\r\n    // Turn ID into a UInt8Array Buffer for some reason\r\n    options.user.id = coerceToArrayBuffer(options.user.id);\r\n\r\n    options.excludeCredentials = options.excludeCredentials.map((c) => {\r\n      c.id = coerceToArrayBuffer(c.id);\r\n      return c;\r\n    });\r\n\r\n    if (options.authenticatorSelection.authenticatorAttachment === null)\r\n      options.authenticatorSelection.authenticatorAttachment = undefined;\r\n\r\n    let newCredential;\r\n    try {\r\n      newCredential = await navigator.credentials.create({\r\n        publicKey: options,\r\n      });\r\n    } catch (e) {\r\n      // todo friendlier and more helpful error detection\r\n      var msg =\r\n        \"Failed during credentials.create in browser. One reason could be because the username is already registered with your authenticator. Please change username or authenticator.\";\r\n      console.warn(msg, e);\r\n      throw e;\r\n    }\r\n\r\n    try {\r\n      await this.registerComplete(newCredential, session);\r\n      this.setHint(\"hint-passwordless\");\r\n    } catch (e) {\r\n      console.warn(\"Failed during register/complete\", e);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Internal function\r\n   */\r\n  async registerBegin(token) {\r\n    const response = await fetch(this.config.apiUrl + \"register/begin\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        token: token,\r\n        ...this._params(),\r\n      }),\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ApiKey: this.config.apiKey,\r\n      },\r\n    });\r\n\r\n    let data = await response.json();\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Internal function\r\n   */\r\n  async registerComplete(newCredential, sessionId) {\r\n    // Move data into Arrays incase it is super long\r\n    let attestationObject = new Uint8Array(\r\n      newCredential.response.attestationObject\r\n    );\r\n    let clientDataJSON = new Uint8Array(newCredential.response.clientDataJSON);\r\n    let rawId = new Uint8Array(newCredential.rawId);\r\n\r\n    const data = {\r\n      id: newCredential.id,\r\n      rawId: coerceToBase64Url(rawId),\r\n      type: newCredential.type,\r\n      extensions: newCredential.getClientExtensionResults(),\r\n      response: {\r\n        AttestationObject: coerceToBase64Url(attestationObject),\r\n        clientDataJson: coerceToBase64Url(clientDataJSON),\r\n      },\r\n    };\r\n\r\n    const response = await fetch(this.config.apiUrl + \"register/complete\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        response: data,\r\n        sessionId,\r\n        sessionId,\r\n        ...this._params(),\r\n      }),\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ApiKey: this.config.apiKey,\r\n      },\r\n    });\r\n\r\n    if (response.status === 200) {\r\n      this.setHint(\"hint-passwordless\");\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * Sign in a user\r\n   *\r\n   * @param {*} username\r\n   * @returns\r\n   * @memberof PasswordlessClient\r\n   */\r\n  async signin(username) {\r\n    checkSupport();\r\n    var options, sessionId;\r\n    try {\r\n      ({ data: options, sessionId } = await this.signinBegin(username));\r\n    } catch (e) {\r\n      console.warn(\"Failed during signin/begin\", e);\r\n      throw e;\r\n    }\r\n\r\n    options.challenge = coerceToArrayBuffer(options.challenge); //const challenge = makeAssertionOptions.challenge.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n\r\n    options.allowCredentials.forEach(function (listItem) {\r\n      listItem.id = coerceToArrayBuffer(listItem.id);\r\n    });\r\n\r\n    let credential;\r\n    try {\r\n      credential = await navigator.credentials.get({ publicKey: options });\r\n    } catch (e) {\r\n      console.warn(\"Failed during credentials.get in browser.\", e);\r\n      throw e;\r\n    }\r\n\r\n    try {\r\n      let response = await this.signinComplete(credential, sessionId);\r\n      return response.data;\r\n    } catch (e) {\r\n      console.warn(\"Failed during signin/complete\", e);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Internal function\r\n   */\r\n  async signinBegin(username) {\r\n    var res = await fetch(this.config.apiUrl + \"signin/begin\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        username: username,\r\n        ...this._params(),\r\n      }),\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        ApiKey: this.config.apiKey,\r\n      },\r\n    });\r\n\r\n    return await res.json();\r\n  }\r\n\r\n  /**\r\n   * Internal function\r\n   */\r\n  async signinComplete(credential, sessionId) {\r\n    // Move data into Arrays incase it is super long\r\n    let authData = new Uint8Array(credential.response.authenticatorData);\r\n    let clientDataJSON = new Uint8Array(credential.response.clientDataJSON);\r\n    let rawId = new Uint8Array(credential.rawId);\r\n    let sig = new Uint8Array(credential.response.signature);\r\n\r\n    const data = {\r\n      id: credential.id,\r\n      rawId: coerceToBase64Url(rawId),\r\n      type: credential.type,\r\n      extensions: credential.getClientExtensionResults(),\r\n      response: {\r\n        authenticatorData: coerceToBase64Url(authData),\r\n        clientDataJson: coerceToBase64Url(clientDataJSON),\r\n        signature: coerceToBase64Url(sig),\r\n      },\r\n    };\r\n\r\n    var response = await fetch(this.config.apiUrl + \"signin/complete\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        response: data,\r\n        sessionId: sessionId,\r\n        ...this._params(),\r\n      }),\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        ApiKey: this.config.apiKey,\r\n      },\r\n    });\r\n\r\n    if (response.status === 200) {\r\n      this.setHint(\"hint-passwordless\");\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * Internal function\r\n   */\r\n  _params() {\r\n    return {\r\n      RPID: this.config.RPID,\r\n      Origin: this.config.Origin,\r\n    };\r\n  }\r\n\r\n  setHint(hint) {\r\n    if (this.config.useHints === \"cookie\") {\r\n      setCookie(hint, \"1\", 365);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if device has been used for passwordless signin before. Treat information as hint and not a fact. False-negatives can happen since information is stored in cookies.\r\n   */\r\n  hasPasswordlessHint() {\r\n    if (this.config.useHints === \"cookie\") {\r\n      return getCookie(\"hint-passwordless\") === \"1\";\r\n    }\r\n  }\r\n}\r\n\r\nexport { PasswordlessClient as Client };\r\n\r\n/**\r\n * Returns true if the device has builtin \"platform\" authenticator (Windows Hello/faceid/fingerprint etc)\r\n */\r\nexport async function isPlatformSupported() {\r\n  if (!isBrowserSupported()) {\r\n    return false;\r\n  }\r\n\r\n  return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\r\n}\r\n\r\n/**\r\n * Returns true if the browser supports PublicKeyCredential\r\n */\r\nexport function isBrowserSupported() {\r\n  if (\r\n    window.PublicKeyCredential === undefined ||\r\n    typeof window.PublicKeyCredential !== \"function\"\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Throws if browser does not support PublicKeyCredential\r\n */\r\nfunction checkSupport() {\r\n  if (!isBrowserSupported()) {\r\n    throw new Error(\r\n      \"WebAuthn and PublicKeyCredentials are not supported on this browser/device\"\r\n    );\r\n  }\r\n}\r\n\r\nconst coerceToArrayBuffer = function (thing) {\r\n  if (typeof thing === \"string\") {\r\n    // base64url to base64\r\n    thing = thing.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n\r\n    // base64 to Uint8Array\r\n    var str = window.atob(thing);\r\n    var bytes = new Uint8Array(str.length);\r\n    for (var i = 0; i < str.length; i++) {\r\n      bytes[i] = str.charCodeAt(i);\r\n    }\r\n    thing = bytes;\r\n  }\r\n\r\n  // Array to Uint8Array\r\n  if (Array.isArray(thing)) {\r\n    thing = new Uint8Array(thing);\r\n  }\r\n\r\n  // Uint8Array to ArrayBuffer\r\n  if (thing instanceof Uint8Array) {\r\n    thing = thing.buffer;\r\n  }\r\n\r\n  // error if none of the above worked\r\n  if (!(thing instanceof ArrayBuffer)) {\r\n    throw new TypeError(\"could not coerce to ArrayBuffer\");\r\n  }\r\n\r\n  return thing;\r\n};\r\n\r\nconst coerceToBase64Url = function (thing) {\r\n  // Array or ArrayBuffer to Uint8Array\r\n  if (Array.isArray(thing)) {\r\n    thing = Uint8Array.from(thing);\r\n  }\r\n\r\n  if (thing instanceof ArrayBuffer) {\r\n    thing = new Uint8Array(thing);\r\n  }\r\n\r\n  // Uint8Array to base64\r\n  if (thing instanceof Uint8Array) {\r\n    var str = \"\";\r\n    var len = thing.byteLength;\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      str += String.fromCharCode(thing[i]);\r\n    }\r\n    thing = window.btoa(str);\r\n  }\r\n\r\n  if (typeof thing !== \"string\") {\r\n    throw new Error(\"could not coerce to string\");\r\n  }\r\n\r\n  // base64 to base64url\r\n  // NOTE: \"=\" at the end of challenge is optional, strip it off here\r\n  thing = thing.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=*$/g, \"\");\r\n\r\n  return thing;\r\n};\r\n\r\nconst setCookie = (name, value, days = 7, path = \"/\") => {\r\n  const expires = new Date(Date.now() + days * 864e5).toUTCString();\r\n  document.cookie =\r\n    name +\r\n    \"=\" +\r\n    encodeURIComponent(value) +\r\n    \"; expires=\" +\r\n    expires +\r\n    \"; path=\" +\r\n    path;\r\n};\r\n\r\nconst getCookie = (name) => {\r\n  return document.cookie.split(\"; \").reduce((r, v) => {\r\n    const parts = v.split(\"=\");\r\n    return parts[0] === name ? decodeURIComponent(parts[1]) : r;\r\n  }, \"\");\r\n};\r\n\r\nconst deleteCookie = (name, path) => {\r\n  setCookie(name, \"\", -1, path);\r\n};\r\n"],"names":[],"mappings":"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"}